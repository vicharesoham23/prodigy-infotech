from scapy.all import rdpcap
from scapy.layers.inet import IP, TCP, UDP, ICMP


def analyze_packets(pcap_file):
    packets = rdpcap(pcap_file)

    print(f"Total packets captured: {len(packets)}\n")

    for i, packet in enumerate(packets, start=1):
        print(f"Packet #{i}")

        if IP in packet:
            ip_layer = packet[IP]
            print(f"Source IP      : {ip_layer.src}")
            print(f"Destination IP : {ip_layer.dst}")

            if TCP in packet:
                print("Protocol       : TCP")
                print(f"Source Port    : {packet[TCP].sport}")
                print(f"Destination Port: {packet[TCP].dport}")

            elif UDP in packet:
                print("Protocol       : UDP")
                print(f"Source Port    : {packet[UDP].sport}")
                print(f"Destination Port: {packet[UDP].dport}")

            elif ICMP in packet:
                print("Protocol       : ICMP")

            else:
                print("Protocol       : Other")

            payload = bytes(packet[IP].payload)
            if payload:
                print("Payload (first 50 bytes):")
                print(payload[:50])
            else:
                print("Payload        : None")

        else:
            print("Non-IP Packet")

        print("-" * 50)


def main():
    print("=== Packet Analyzer (Educational Use Only) ===")
    pcap_file = input("Enter path to PCAP file: ")
    analyze_packets(pcap_file)


if __name__ == "__main__":
    main()
